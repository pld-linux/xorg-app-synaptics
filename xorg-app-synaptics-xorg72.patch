--- synaptics-0.14.6/synaptics.c.orig	2007-02-24 14:54:42.000000000 +0000
+++ synaptics-0.14.6/synaptics.c	2007-02-24 16:43:41.000000000 +0000
@@ -72,6 +72,7 @@
 #include <xf86Optrec.h>  		/* needed for Options */
 #endif
 
+#define DBG(lvl, f)
 
 /*****************************************************************************
  *	Local Headers
@@ -321,8 +322,10 @@
     local->private_flags           = 0;
     local->flags                   = XI86_POINTER_CAPABLE | XI86_SEND_DRAG_EVENTS;
     local->conf_idev               = dev;
+#if GET_ABI_MAJOR(ABI_XINPUT_VERSION) == 0
     local->motion_history_proc     = xf86GetMotionEvents;
     local->history_size            = 0;
+#endif
     local->always_core_feedback    = 0;
 
     xf86Msg(X_INFO, "Synaptics touchpad driver version %s (%d)\n", VERSION, VERSION_ID);
@@ -455,7 +458,9 @@
 	goto SetupProc_fail;
     }
 
+#if GET_ABI_MAJOR(ABI_XINPUT_VERSION) == 0
     local->history_size = xf86SetIntOption(opts, "HistorySize", 0);
+#endif
 
     xf86ProcessCommonOptions(local, opts);
     local->flags |= XI86_CONFIGURED;
@@ -613,8 +618,18 @@
 
     InitPointerDeviceStruct((DevicePtr)dev, map,
 			    SYN_MAX_BUTTONS,
-			    miPointerGetMotionEvents, SynapticsCtrl,
-			    miPointerGetMotionBufferSize());
+#if GET_ABI_MAJOR(ABI_XINPUT_VERSION) == 0
+			    miPointerGetMotionEvents,
+#else
+			    GetMotionHistory,
+#endif
+			    SynapticsCtrl,
+#if GET_ABI_MAJOR(ABI_XINPUT_VERSION) == 0
+			    miPointerGetMotionBufferSize()
+#else
+			    GetMotionHistorySize(), 2
+#endif
+			    );
 
     /* X valuator */
     xf86InitValuatorAxisStruct(dev, 0, 0, -1, 1, 0, 1);
@@ -623,7 +638,9 @@
     xf86InitValuatorAxisStruct(dev, 1, 0, -1, 1, 0, 1);
     xf86InitValuatorDefaults(dev, 1);
 
+#if GET_ABI_MAJOR(ABI_XINPUT_VERSION) == 0
     xf86MotionHistoryAllocate(local);
+#endif
 
     if (!alloc_param_data(local))
 	return !Success;
--- synaptics-0.14.6/ps2comm.c.orig	2007-02-24 16:44:46.000000000 +0000
+++ synaptics-0.14.6/ps2comm.c	2007-02-24 16:45:06.000000000 +0000
@@ -60,6 +60,8 @@
 #define PS2DBG(x)
 #endif
 
+#define DBG(lvl, f)
+
 /*****************************************************************************
  *	PS/2 Utility functions.
  *     Many parts adapted from tpconfig.c by C. Scott Ananian
